<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperliquid Copy Trading</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <link rel="stylesheet" href="styles/main.css">
    <script src="https://cdn.jsdelivr.net/npm/ccxt@4.5.11/dist/ccxt.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.15.0/dist/ethers.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Hyperliquid Copy Trading</h1>
            <p class="subtitle">Monitor top wallets and automatically copy their positions</p>
        </header>

        <!-- Two-Column Layout: Wallets + Order History -->
        <div class="two-column-layout">
            <!-- Left Column: Monitoring Wallets -->
            <section class="wallets-section">
                <div class="section-header">
                    <h2>üëÅÔ∏è Monitoring Wallets</h2>
                    <button class="collapse-toggle" id="wallets-toggle" aria-label="Toggle monitoring wallets">
                        <span class="collapse-icon">‚àí</span>
                    </button>
                </div>
                <div class="collapsible-content" id="wallets-content">
                    <p style="color:#888; font-size:14px; margin-bottom:10px;">
                        üîç Pre-configured wallet addresses for monitoring. Click a wallet to view order history and auto-fill the trader address.
                    </p>
                    <div class="table-container">
                        <table id="wallets-table">
                            <thead>
                                <tr>
                                    <th>Label</th>
                                    <th>Wallet Address</th>
                                </tr>
                            </thead>
                            <tbody id="wallets-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Right Column: Positions & Order History -->
            <section class="history-section">
                <div class="section-header">
                    <h2>Positions & History</h2>
                    <button class="collapse-toggle" id="history-toggle" aria-label="Toggle positions and history">
                        <span class="collapse-icon">‚àí</span>
                    </button>
                </div>
                <div class="collapsible-content" id="history-content-wrapper">
                    <div id="history-placeholder" style="text-align:center; padding:60px 20px; color:#666;">
                        üëÜ Select a wallet to view their positions & history
                    </div>
                    <div id="history-loading" style="display:none; text-align:center; padding:40px;">
                        Loading...
                    </div>
                    <div id="history-error" class="error-message" style="display:none;"></div>
                    <div id="history-content" style="display:none;">
                    <div style="margin-bottom:20px; color:#888;">
                        <strong>Wallet:</strong> <span id="history-address"></span>
                    </div>

                    <!-- Balance Section -->
                    <div id="selected-balance-section" style="margin-bottom:30px;">
                        <h3 style="color:#4a9eff; margin-bottom:15px; font-size:1.2em;">üí∞ Balance</h3>
                        <div id="selected-balance-loading" style="display:none; text-align:center; padding:20px; color:#666;">
                            Loading balance...
                        </div>
                        <div id="selected-balance-error" class="error-message" style="display:none;"></div>
                        <div id="selected-balance-content">
                            <!-- Balance will be populated here -->
                        </div>
                    </div>

                    <!-- Positions Section (Above History) -->
                    <div id="selected-positions-section" style="margin-bottom:30px;">
                        <h3 style="color:#4a9eff; margin-bottom:15px; font-size:1.2em;">üìà Open Positions</h3>
                        <div id="selected-positions-loading" style="display:none; text-align:center; padding:20px; color:#666;">
                            Loading positions...
                        </div>
                        <div id="selected-positions-error" class="error-message" style="display:none;"></div>
                        <div id="selected-positions-content">
                            <!-- Positions will be populated here -->
                        </div>
                    </div>

                    <!-- Order History Section (Below Positions) -->
                    <div>
                        <h3 style="color:#4a9eff; margin-bottom:15px; font-size:1.2em;">üìú Order History</h3>
                        <div style="margin-bottom:10px; color:#666; font-size:0.9em;">
                            Aggregated orders (fills combined)
                        </div>
                        <div class="table-container">
                            <table id="history-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Symbol</th>
                                        <th>Side</th>
                                        <th>Direction</th>
                                        <th>Size</th>
                                        <th>Avg Price</th>
                                        <th>PnL</th>
                                        <th>Fills</th>
                                    </tr>
                                </thead>
                                <tbody id="history-body">
                                    <!-- Populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                </div>
            </section>
        </div>

        <!-- User Story 2: Configuration Form -->
        <section class="config-section">
            <h2>Configure Copy Trading</h2>
            <form id="config-form">
                <div class="form-group">
                    <label for="trader-address">Trader Address (40 hex characters)</label>
                    <input type="text" id="trader-address" placeholder="0x..." required>
                    <span class="validation-error" id="trader-address-error"></span>
                </div>

                <div class="form-group">
                    <label for="api-key">Hyperliquid API Key (from app.hyperliquid.xyz/API)</label>
                    <input type="password" id="api-key" placeholder="0x..." required>
                    <span class="validation-error" id="api-key-error"></span>
                    <div style="margin-top: 8px;">
                        <label style="display: inline-flex; align-items: center; font-weight: normal; cursor: pointer;">
                            <input type="checkbox" id="save-api-key" style="margin-right: 8px;">
                            <span>Remember API key (localStorage - use test account only)</span>
                        </label>
                    </div>
                    <small class="warning">‚ö†Ô∏è API key has full trading permissions. Use a dedicated test account, never your main account.</small>
                </div>

                <div class="form-group">
                    <label for="copy-balance">Total Balance for Copying (USD, min $50)</label>
                    <input type="number" id="copy-balance" placeholder="1000" min="50" step="1" required>
                    <span class="validation-error" id="copy-balance-error"></span>
                    <small style="color:#888; display:block; margin-top:4px;">
                        System will copy trader's exact position sizes (when within your balance)
                    </small>
                </div>

                <div class="button-group">
                    <button type="button" id="test-calculation-button" style="background-color:#4a9eff; color:white;">üìä Test Position Calculation</button>
                    <button type="button" id="start-button" disabled>Start Copy Trading</button>
                    <button type="button" id="stop-button" disabled>Stop Copy Trading</button>
                </div>
            </form>

            <!-- Position Calculation Test Results -->
            <div id="calculation-test-results" style="display:none; margin-top:20px; padding:20px; background-color:#0f1420; border-radius:6px; border:1px solid #2a3550;">
                <!-- Results will be populated here -->
            </div>
        </section>

        <!-- Wallet Info Section -->
        <section class="wallet-info-section">
            <div class="section-header">
                <h2>üí∞ My Wallet & Positions</h2>
                <button class="refresh-button" id="refresh-wallet-button" disabled>
                    <span>Refresh</span>
                </button>
            </div>

            <div id="your-wallet-loading" style="display:none; text-align:center; padding:40px; color:#666;">
                Loading...
            </div>
            <div id="your-wallet-error" class="error-message" style="display:none;"></div>
            <div id="your-wallet-placeholder" style="text-align:center; padding:40px; color:#666;">
                Enter API key and click Refresh to view your wallet
            </div>

            <div id="your-wallet-content" style="display:none;">
                <!-- Balance Summary -->
                <div style="background-color:#0f1420; padding:20px; border-radius:6px; margin-bottom:20px; border:1px solid #2a3550;">
                    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:20px;">
                        <div>
                            <div style="color:#888; font-size:0.9em; margin-bottom:5px;">Available</div>
                            <div style="color:#e0e0e0; font-size:1.3em; font-weight:600;" id="your-balance-free">$0.00</div>
                        </div>
                        <div>
                            <div style="color:#888; font-size:0.9em; margin-bottom:5px;">In Use</div>
                            <div style="color:#e0e0e0; font-size:1.3em; font-weight:600;" id="your-balance-used">$0.00</div>
                        </div>
                        <div>
                            <div style="color:#888; font-size:0.9em; margin-bottom:5px;">Total Balance</div>
                            <div style="color:#e0e0e0; font-size:1.3em; font-weight:600;" id="your-balance-total">$0.00</div>
                        </div>
                        <div>
                            <div style="color:#888; font-size:0.9em; margin-bottom:5px;">Position Value</div>
                            <div style="color:#e0e0e0; font-size:1.3em; font-weight:600;" id="your-position-value">$0.00</div>
                        </div>
                        <div>
                            <div style="color:#888; font-size:0.9em; margin-bottom:5px;">Unrealized PnL</div>
                            <div class="balance-value pnl" style="font-size:1.3em; font-weight:600;" id="your-unrealized-pnl">$0.00</div>
                        </div>
                    </div>
                </div>

                <!-- Positions Table -->
                <h3 style="color:#4a9eff; margin-bottom:15px; font-size:1.2em;">üìà Open Positions</h3>
                <div id="your-positions-body">
                    <p style="text-align:center; padding:20px; color:#666;">No open positions</p>
                </div>
            </div>
        </section>

        <!-- User Story 4: Recent Orders Display -->
        <section class="orders-section">
            <div class="section-header">
                <h2>Recent Orders (Last 6)</h2>
            </div>
            <div class="table-container">
                <table id="orders-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Side</th>
                            <th>Amount</th>
                            <th>Price</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody id="orders-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Session Confirmation Modal -->
    <div id="trade-confirm-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <h3 style="margin-top:0; color:#4a9eff;">Confirm Copy Trading Session</h3>
            <div id="trade-confirm-details" style="margin:20px 0;">
                <!-- Session details will be populated here -->
            </div>
            <div class="button-group" style="justify-content:flex-end;">
                <button id="trade-confirm-cancel" class="button-secondary">Cancel</button>
                <button id="trade-confirm-execute" class="button-primary">Start Copy Trading</button>
            </div>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>
