<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperliquid Copy Trading</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    <link rel="stylesheet" href="styles/main.css">
    <script src="https://cdn.jsdelivr.net/npm/ccxt@4.5.11/dist/ccxt.browser.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Hyperliquid Copy Trading</h1>
            <p class="subtitle">Discover top traders and automatically copy their positions</p>
        </header>

        <!-- User Story 1: Two-Column Layout (Leaderboard + History) -->
        <div class="two-column-layout">
            <!-- Left Column: Leaderboard -->
            <section class="leaderboard-section">
                <div class="section-header">
                    <h2>Top 20 Traders (Monthly ROI)</h2>
                    <button class="collapse-toggle" id="leaderboard-toggle" aria-label="Toggle leaderboard">
                        <span class="collapse-icon">‚àí</span>
                    </button>
                </div>
                <div class="collapsible-content" id="leaderboard-content">
                    <p style="color:#888; font-size:14px; margin-bottom:10px;">
                        üìä Active traders with $50K+ accounts, sorted by monthly ROI. Click a trader to view order history.
                    </p>
                    <div id="leaderboard-error" class="error-message" style="display:none;"></div>
                    <div class="table-container">
                    <table id="leaderboard-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Trader</th>
                                <th>Account</th>
                                <th>ROI</th>
                                <th>PnL</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                            <!-- Populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                </div>
            </section>

            <!-- Right Column: Order History -->
            <section class="history-section">
                <div class="section-header">
                    <h2>Order History</h2>
                    <button class="collapse-toggle" id="history-toggle" aria-label="Toggle order history">
                        <span class="collapse-icon">‚àí</span>
                    </button>
                </div>
                <div class="collapsible-content" id="history-content-wrapper">
                    <div id="history-placeholder" style="text-align:center; padding:60px 20px; color:#666;">
                        üëà Select a trader from the leaderboard to view their order history
                    </div>
                    <div id="history-loading" style="display:none; text-align:center; padding:40px;">
                        Loading order history...
                    </div>
                    <div id="history-error" class="error-message" style="display:none;"></div>
                    <div id="history-content" style="display:none;">
                    <div style="margin-bottom:15px; color:#888;">
                        <strong>Trader:</strong> <span id="history-address"></span>
                        <span style="margin-left:20px; color:#666;">Aggregated orders (fills combined)</span>
                    </div>
                    <div class="table-container">
                        <table id="history-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th>Direction</th>
                                    <th>Size</th>
                                    <th>Avg Price</th>
                                    <th>PnL</th>
                                    <th>Fills</th>
                                </tr>
                            </thead>
                            <tbody id="history-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                </div>
            </section>
        </div>

        <!-- User Story 2: Configuration Form -->
        <section class="config-section">
            <h2>Configure Copy Trading</h2>
            <form id="config-form">
                <div class="form-group">
                    <label for="trader-address">Trader Address (40 hex characters)</label>
                    <input type="text" id="trader-address" placeholder="0x..." required>
                    <span class="validation-error" id="trader-address-error"></span>
                </div>

                <div class="form-group">
                    <label for="api-key">Your API Key (64 hex characters)</label>
                    <input type="password" id="api-key" placeholder="0x..." required>
                    <span class="validation-error" id="api-key-error"></span>
                    <div style="margin-top: 8px;">
                        <label style="display: inline-flex; align-items: center; font-weight: normal; cursor: pointer;">
                            <input type="checkbox" id="save-api-key" style="margin-right: 8px;">
                            <span>Remember API key (less secure, but convenient)</span>
                        </label>
                    </div>
                    <small class="warning">‚ö†Ô∏è API key has full trading permissions. Never share it.</small>
                </div>

                <div class="form-group">
                    <label for="trade-value">Trade Value per Position (USD, min $12)</label>
                    <input type="number" id="trade-value" placeholder="50" min="12" step="1" required>
                    <span class="validation-error" id="trade-value-error"></span>
                </div>

                <div class="form-group">
                    <label for="max-leverage">Max Leverage (1-50x)</label>
                    <input type="number" id="max-leverage" placeholder="10" min="1" max="50" step="1" required>
                    <span class="validation-error" id="max-leverage-error"></span>
                </div>

                <div class="button-group">
                    <button type="button" id="start-button" disabled>Start Copy Trading</button>
                    <button type="button" id="stop-button" disabled>Stop Copy Trading</button>
                </div>
            </form>
        </section>

        <!-- User Story 4: Recent Orders Display -->
        <section class="orders-section">
            <div class="section-header">
                <h2>Recent Orders (Last 6)</h2>
                <button type="button" id="test-order-button" class="test-button" title="Create a test order for UI testing">
                    üß™ Test Order
                </button>
            </div>
            <div class="table-container">
                <table id="orders-table">
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Side</th>
                            <th>Amount</th>
                            <th>Price</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody id="orders-body">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <!-- Test Order Modal -->
    <div id="test-order-modal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üß™ Create Test Order</h3>
                <button class="modal-close" id="test-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="test-symbol">Symbol</label>
                    <select id="test-symbol">
                        <option value="BTC/USD:USD">BTC/USD:USD</option>
                        <option value="ETH/USD:USD">ETH/USD:USD</option>
                        <option value="SOL/USD:USD">SOL/USD:USD</option>
                        <option value="ARB/USD:USD">ARB/USD:USD</option>
                        <option value="AVAX/USD:USD">AVAX/USD:USD</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="test-side">Side</label>
                    <select id="test-side">
                        <option value="buy">Buy</option>
                        <option value="sell">Sell</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="test-amount">Amount</label>
                    <input type="number" id="test-amount" placeholder="e.g., 1.5" step="0.0001" min="0">
                </div>
                <div class="form-group">
                    <label for="test-price">Price (USD)</label>
                    <input type="number" id="test-price" placeholder="e.g., 45000" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label for="test-leverage">Leverage (optional, display only)</label>
                    <input type="number" id="test-leverage" placeholder="e.g., 10" step="1" min="1" max="50">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="test-modal-random" class="secondary-button">Random Values</button>
                <button type="button" id="test-modal-submit" class="primary-button">Create Order</button>
            </div>
        </div>
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>
