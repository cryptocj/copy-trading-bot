<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Position Sync Monitor</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîÑ</text></svg>">

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NN3P9KC9');</script>
    <!-- End Google Tag Manager -->

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4a9eff',
                        dark: { 900: '#0a0e1a', 800: '#0f1420', 700: '#151b2e', 600: '#1a2137', 500: '#2a3550' }
                    }
                }
            }
        }
    </script>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/ccxt@4.5.11/dist/ccxt.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.15.0/dist/ethers.umd.min.js"></script>

    <style>
        /* Table styles */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid #2a3550;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .table-container table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75rem;
            background-color: #0f1420;
        }
        .table-container thead {
            background: linear-gradient(to right, #1a2137, #151b2e);
        }
        .table-container thead tr th {
            padding: 10px 12px;
            text-align: left;
            color: #d1d5db;
            font-weight: 600;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid #2a3550;
        }
        .table-container tbody tr {
            border-bottom: 1px solid #2a3550;
        }
        .table-container tbody tr:nth-child(even) { background-color: #0f1420; }
        .table-container tbody tr:nth-child(odd) { background-color: #151b2e; }
        .table-container tbody tr:hover {
            background-color: #1a2137 !important;
        }
        .table-container tbody td {
            padding: 10px 12px;
            color: #e5e7eb;
            font-size: 0.75rem;
        }

        /* Time column width */
        .table-container thead tr th:last-child,
        .table-container tbody tr td:last-child {
            min-width: 160px;
            width: 160px;
            white-space: nowrap;
        }

        /* Side badges */
        .side-long {
            color: #10b981;
            background-color: rgba(16, 185, 129, 0.1);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.7rem;
            display: inline-block;
        }
        .side-short {
            color: #ef4444;
            background-color: rgba(239, 68, 68, 0.1);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.7rem;
            display: inline-block;
        }

        /* Activity log */
        #activity-log {
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
        }
        #activity-log::-webkit-scrollbar {
            width: 8px;
        }
        #activity-log::-webkit-scrollbar-track {
            background: #0f1420;
        }
        #activity-log::-webkit-scrollbar-thumb {
            background: #2a3550;
            border-radius: 4px;
        }
        #activity-log::-webkit-scrollbar-thumb:hover {
            background: #4a9eff;
        }

        .log-entry {
            padding: 4px 8px;
            border-left: 2px solid transparent;
            margin-bottom: 2px;
        }
        .log-entry.success { border-left-color: #10b981; }
        .log-entry.error { border-left-color: #ef4444; }
        .log-entry.warning { border-left-color: #ffa726; }
        .log-entry.info { border-left-color: #4a9eff; }

        /* Monitoring Status Indicator */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .status-indicator.active {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* Stat card animation */
        @keyframes countUp {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        .stat-card.updated {
            animation: countUp 0.3s ease-in-out;
        }
    </style>

</head>
<body class="bg-dark-900 text-gray-200">
    <div class="container mx-auto px-4 py-4 max-w-[1600px]">

        <!-- Header -->
        <header class="text-center mb-4 bg-gradient-to-br from-dark-600 to-dark-800 rounded-lg p-4 shadow-lg">
            <div class="flex justify-between items-center">
                <div class="flex-1"></div>
                <div class="flex-1 text-center">
                    <h1 class="text-3xl font-bold text-primary mb-1">üîÑ Position Sync Monitor</h1>
                    <p class="text-gray-400 text-sm">Real-time copy trading synchronization</p>
                </div>
                <div class="flex-1 text-right">
                    <span class="text-xs text-gray-500 font-mono" id="version-display">v0.0.0</span>
                </div>
            </div>
        </header>

        <!-- Security & Privacy Notice -->
        <div class="mb-4 bg-gradient-to-r from-green-900/20 to-blue-900/20 border border-green-500/30 rounded-lg p-3">
            <div class="flex items-start gap-3">
                <div class="text-2xl">üîí</div>
                <div class="flex-1">
                    <h3 class="text-sm font-semibold text-green-400 mb-1">100% Client-Side & Private</h3>
                    <p class="text-xs text-gray-300 leading-relaxed">
                        This application runs <strong>entirely in your browser</strong>. No backend servers, no data storage, no private key transmission.
                        Your private keys never leave your device and are only used locally to sign transactions.
                        All API calls are made directly from your browser to public blockchain nodes and exchanges.
                    </p>
                </div>
            </div>
        </div>

        <!-- Quick Start Guide -->
        <div class="mb-4 bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-500/30 rounded-lg p-3">
            <div class="flex items-start gap-3">
                <div class="text-2xl">üìö</div>
                <div class="flex-1">
                    <h3 class="text-sm font-semibold text-blue-400 mb-2">Quick Start Guide</h3>

                    <!-- Setup Steps -->
                    <div class="mb-3 text-xs text-gray-300">
                        <div class="font-medium text-blue-300 mb-1.5">Setup Steps:</div>
                        <ol class="list-decimal list-inside space-y-1 ml-2">
                            <li>Select an AI trader from the dropdown (or enter custom address)</li>
                            <li>Enter your wallet private key</li>
                            <li>Ensure you have <strong>enough USDC</strong> and <strong>CRO</strong> (for gas) in your wallet</li>
                            <li>Click <strong>"Start Monitoring"</strong> to begin copy trading</li>
                        </ol>
                    </div>

                    <!-- Important Notes -->
                    <div class="mb-3 bg-orange-900/20 border border-orange-500/30 rounded p-2 text-xs">
                        <div class="font-medium text-orange-400 mb-1">‚ö†Ô∏è Important Notes:</div>
                        <ul class="list-disc list-inside space-y-0.5 ml-2 text-gray-300">
                            <li><strong>BNB not supported:</strong> Moonlander doesn't list BNB. If you choose DeepSeek, have <strong>$300-$500 USDC</strong> minimum (BNB positions will be skipped)</li>
                            <li><strong>Minimum balance:</strong> $50 USDC recommended, but higher balances work better for copying multiple positions</li>
                            <li><strong>Gas fees:</strong> Keep some CRO in your wallet for transaction fees</li>
                        </ul>
                    </div>

                    <!-- Safety Tips -->
                    <div class="mb-3 bg-red-900/20 border border-red-500/30 rounded p-2 text-xs">
                        <div class="font-medium text-red-400 mb-1">üõ°Ô∏è Safety Tips:</div>
                        <ul class="list-disc list-inside space-y-0.5 ml-2 text-gray-300">
                            <li><strong>Always start with a FRESH WALLET</strong> - Use a new wallet dedicated only to copy trading</li>
                            <li><strong>Always DYOR</strong> (Do Your Own Research) - Understand the risks before copying any trader</li>
                            <li><strong>Always start with a small amount</strong> - Test with minimal funds first, then scale up gradually</li>
                        </ul>
                    </div>

                    <!-- Quick Links -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                        <a href="https://nof1.ai/" target="_blank" rel="noopener noreferrer"
                           class="flex items-center gap-2 px-3 py-2 bg-dark-800/50 hover:bg-dark-700/50 border border-dark-500 rounded transition-colors group">
                            <span class="text-base">ü§ñ</span>
                            <div class="flex-1">
                                <div class="font-medium text-blue-400 group-hover:text-blue-300 text-xs">AI Bot Performance</div>
                                <div class="text-gray-400 text-xs">View live stats & rankings</div>
                            </div>
                            <span class="text-gray-500 group-hover:text-gray-400">‚Üó</span>
                        </a>
                        <a href="https://moonlander.trade/" target="_blank" rel="noopener noreferrer"
                           class="flex items-center gap-2 px-3 py-2 bg-dark-800/50 hover:bg-dark-700/50 border border-dark-500 rounded transition-colors group">
                            <span class="text-base">üåô</span>
                            <div class="flex-1">
                                <div class="font-medium text-purple-400 group-hover:text-purple-300 text-xs">Moonlander Trading</div>
                                <div class="text-gray-400 text-xs">Check positions & trade</div>
                            </div>
                            <span class="text-gray-500 group-hover:text-gray-400">‚Üó</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Form -->
        <section class="bg-dark-700 rounded-lg shadow-lg p-4 mb-4">
            <h2 class="text-lg font-semibold text-primary mb-3">‚öôÔ∏è Configuration</h2>
            <form id="config-form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Select Trader</label>
                    <select id="trader-select"
                        class="w-full px-2.5 py-1.5 text-sm bg-dark-800 border border-dark-500 rounded focus:border-primary focus:ring-1 focus:ring-primary outline-none text-gray-200">
                        <option value="">-- Select a trader --</option>
                        <option value="0x1b7a7d099a670256207a30dd0ae13d35f278010f">Gemini 2.5 Pro</option>
                        <option value="0x67293d914eafb26878534571add81f6bd2d9fe06">GPT-5</option>
                        <option value="0x7a8fd8bba33e37361ca6b0cb4518a44681bad2f3">Qwen3 Max</option>
                        <option value="0x59fa085d106541a834017b97060bcbbb0aa82869">Claude Sonnet 4.5</option>
                        <option value="0x56d652e62998251b56c8398fb11fcfe464c08f84">Grok-4</option>
                        <option value="0xc20ac4dc4188660cbf555448af52694ca62b0734">DeepSeek V3.1</option>
                        <option value="custom">Custom Address...</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Trader Platform</label>
                    <select id="trader-platform"
                        class="w-full px-2.5 py-1.5 text-sm bg-dark-800 border border-dark-500 rounded focus:border-primary focus:ring-1 focus:ring-primary outline-none text-gray-200">
                        <option value="hyperliquid">Hyperliquid (Default)</option>
                        <option value="moonlander">Moonlander (Cronos)</option>
                    </select>
                </div>
                
                <div id="custom-address-container" style="display: none;">
                    <label class="block text-sm font-medium text-gray-400 mb-1">Custom Trader Address</label>
                    <input type="text" id="trader-address" placeholder="0x..." required
                        class="w-full px-2.5 py-1.5 text-sm bg-dark-800 border border-dark-500 rounded focus:border-primary focus:ring-1 focus:ring-primary outline-none text-gray-200">
                </div>



                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">
                        Wallet Private Key (Copy Trading)
                        <span class="text-xs text-green-400 ml-1" title="Your key never leaves your browser">üîí locally</span>
                    </label>
                    <input type="password" id="moonlander-private-key" placeholder="0x..." autocomplete="off"
                        title="Your private key is only used locally in your browser to sign transactions. It is never sent to any server."
                        class="w-full px-2.5 py-1.5 text-sm bg-dark-800 border border-dark-500 rounded focus:border-primary focus:ring-1 focus:ring-primary outline-none text-gray-200">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Total Equity ($)</label>
                    <input type="number" id="copy-balance" placeholder="Auto-fetch from wallet" value="" min="100" step="1" readonly
                        class="w-full px-2.5 py-1.5 text-sm bg-dark-900 border border-dark-500 rounded text-gray-400 cursor-not-allowed">
                    <p class="text-xs text-gray-500 mt-1">Free balance + positions value</p>
                </div>


                <div class="md:col-span-2 lg:col-span-4 flex gap-2 items-center">
                    <button type="button" id="start-button"
                        class="px-4 py-2 text-sm font-medium bg-green-600 hover:bg-green-700 text-white rounded transition">
                        ‚ñ∂Ô∏è Start Monitoring
                    </button>
                    <button type="button" id="stop-button" disabled
                        class="px-4 py-2 text-sm font-medium bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white rounded transition">
                        ‚è∏Ô∏è Stop
                    </button>

                    <!-- Status Indicator -->
                    <div id="status-display" class="hidden ml-auto flex items-center gap-2 px-3 py-1.5 bg-dark-800 rounded border border-dark-500">
                        <div class="status-indicator w-3 h-3 rounded-full bg-green-500 active"></div>
                        <span class="text-sm font-medium text-gray-200">Monitoring Active</span>
                    </div>
                </div>
            </form>
        </section>


        <!-- Positions Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
            <!-- Trader Positions -->
            <section class="bg-dark-700 rounded-lg shadow-lg">
                <div class="p-4 border-b border-dark-500">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-lg font-semibold text-primary">üë§ Trader Positions</h2>
                        <span class="text-sm text-gray-400" id="trader-position-count">0 positions</span>
                    </div>
                    <div class="text-xs text-gray-500 flex gap-4">
                        <span>Balance: <span class="text-gray-300 font-medium" id="balance-trader-total">$0.00</span></span>
                        <span>Available: <span class="text-green-400 font-medium" id="balance-trader-available">$0.00</span></span>
                        <span>Margin: <span class="text-yellow-400 font-medium" id="balance-trader-margin">$0.00</span></span>
                        <span>Position Value: <span class="text-purple-400 font-medium" id="balance-trader-position-value">$0.00</span></span>
                        <span>PnL: <span class="font-medium" id="balance-trader-pnl">$0.00</span></span>
                        <span>Ratio: <span class="text-blue-400 font-medium" id="balance-trader-ratio">0.0%</span></span>
                    </div>
                </div>
                <div class="p-4">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th class="text-right">Size</th>
                                    <th class="text-right">Entry</th>
                                    <th class="text-right">PnL</th>
                                    <th class="text-right">Stop Loss</th>
                                    <th class="text-right">Take Profit</th>
                                    <th class="text-right">Liq Price</th>
                                    <th class="text-right">Leverage</th>
                                    <th class="text-right">Margin</th>
                                    <th class="text-right">Position Value</th>
                                    <th class="text-right">Margin %</th>
                                    <th class="text-right">Time</th>
                                </tr>
                            </thead>
                            <tbody id="trader-positions-body">
                                <tr><td colspan="13" class="text-center text-gray-500 py-4">Not monitoring</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Your Positions -->
            <section class="bg-dark-700 rounded-lg shadow-lg">
                <div class="p-4 border-b border-dark-500">
                    <div class="flex justify-between items-center mb-2">
                        <h2 class="text-lg font-semibold text-primary">üìç Your Positions</h2>
                        <span class="text-sm text-gray-400" id="user-position-count">0 positions</span>
                    </div>
                    <div class="text-xs text-gray-500 flex gap-4">
                        <span>Balance: <span class="text-gray-300 font-medium" id="balance-user-total">$0.00</span></span>
                        <span>Available: <span class="text-green-400 font-medium" id="balance-user-available">$0.00</span></span>
                        <span>Margin: <span class="text-yellow-400 font-medium" id="balance-user-margin">$0.00</span></span>
                        <span>Position Value: <span class="text-purple-400 font-medium" id="balance-user-position-value">$0.00</span></span>
                        <span>PnL: <span class="font-medium" id="balance-user-pnl">$0.00</span></span>
                        <span>Ratio: <span class="text-blue-400 font-medium" id="balance-user-ratio">0.0%</span></span>
                        <span class="ml-2 text-cyan-400">Scaling: <span class="font-medium" id="balance-scaling-factor">0.0%</span></span>
                    </div>
                </div>
                <div class="p-4">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Side</th>
                                    <th class="text-right">Size</th>
                                    <th class="text-right">Entry</th>
                                    <th class="text-right">PnL</th>
                                    <th class="text-right">Stop Loss</th>
                                    <th class="text-right">Take Profit</th>
                                    <th class="text-right">Liq Price</th>
                                    <th class="text-right">Leverage</th>
                                    <th class="text-right">Margin</th>
                                    <th class="text-right">Position Value</th>
                                    <th class="text-right">Margin %</th>
                                    <th class="text-right">Time</th>
                                </tr>
                            </thead>
                            <tbody id="user-positions-body">
                                <tr><td colspan="13" class="text-center text-gray-500 py-4">Not monitoring</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>


        <!-- Actions Panel -->
        <section class="bg-dark-700 rounded-lg shadow-lg mb-4">
            <div class="p-4 border-b border-dark-500">
                <h2 class="text-lg font-semibold text-primary">üîÑ Required Actions</h2>
            </div>
            <div class="p-4">
                <div id="actions-content" class="space-y-2">
                    <div class="text-center text-gray-500 py-4">Start monitoring to see actions</div>
                </div>
            </div>
        </section>
        <!-- Activity Log -->
        <section class="bg-dark-700 rounded-lg shadow-lg">
            <div class="p-4 border-b border-dark-500">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-lg font-semibold text-primary">üìú Activity Log</h2>
                    <button id="clear-log-btn" class="px-3 py-1.5 text-xs font-medium bg-dark-600 hover:bg-dark-500 text-gray-200 rounded transition">
                        Clear
                    </button>
                </div>
                <div class="flex flex-wrap gap-4 text-xs text-gray-400">
                    <span>üí∞ Balance: <span class="text-gray-200 font-medium" id="stat-balance">$0.00</span></span>
                    <span>üìä Syncs: <span class="text-gray-200 font-medium" id="stat-syncs">0</span></span>
                    <span>‚ûï Added: <span class="text-green-400 font-medium" id="stat-added">0</span></span>
                    <span>‚ûñ Removed: <span class="text-red-400 font-medium" id="stat-removed">0</span></span>
                    <span>‚ùå Errors: <span class="text-red-400 font-medium" id="stat-errors">0</span></span>
                </div>
            </div>
            <div class="p-4">
                <div id="activity-log" class="bg-dark-800 rounded p-3 border border-dark-500">
                    <div class="log-entry info">
                        <span class="text-gray-500">[Ready]</span> Configure and start monitoring
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script type="module" src="./js/main.js"></script>


    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PEGGJKETQ0"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-PEGGJKETQ0');
    </script>
</body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NN3P9KC9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
</html>
